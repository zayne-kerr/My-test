<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Conversation Info2</title>
</head>
<body>
  <h2>Conversation Info2</h2>
  <p><strong>Conversation ID:</strong> <span id="conversationId">Loading...</span></p>
  <p><strong>Status:</strong> <span id="statusText">Checking authentication...</span></p>
  <button id="fetchBtn" disabled>Fetch Conversation</button>
  <pre id="responseOutput"></pre>

 <script>
document.addEventListener("DOMContentLoaded", () => {
  const CLIENT_ID = "277e7dba-0dc0-4066-9f5b-0db9f909ae5b";
  const REDIRECT_URI = "https://zayne-kerr.github.io/My-test/test.html";
  const AUTH_URL = "https://login.mypurecloud.ie/oauth/authorize";
  const SCOPES = "conversation:call:view conversation:call:edit";

  console.log("üîé Current URL:", window.location.href);
  console.log("üîé Hash:", window.location.hash);

  const hash = window.location.hash.substring(1);
  const params = new URLSearchParams(hash);
  const token = params.get("access_token");

  if (token) {
    console.log("‚úÖ Found access_token, saving...");
    sessionStorage.setItem("gc_token", token);
    window.history.replaceState({}, document.title, window.location.pathname + window.location.search);
    document.body.innerHTML = "<h3>Token captured ‚úÖ</h3>";
    return;
  }

  const saved = sessionStorage.getItem("gc_token");
  if (!saved) {
    const authUrl =
      `${AUTH_URL}?response_type=token` +
      `&client_id=${encodeURIComponent(CLIENT_ID)}` +
      `&redirect_uri=${encodeURIComponent(REDIRECT_URI)}` +
      `&scope=${encodeURIComponent(SCOPES)}&state=xyz`;
    console.log("üîÅ Redirecting to:", authUrl);
    window.location.href = authUrl;
  } else {
    document.body.innerHTML = "<h3>Token loaded ‚úÖ</h3>";
  }
});
</script>

</body>
</html>
