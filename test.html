<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Conversation Info</title>
  <style>
    body {
      font-family: "Roboto", sans-serif;
      background: #f5f6fa;
      color: #222;
      padding: 2rem;
    }
    .container {
      background: white;
      border-radius: 12px;
      padding: 1.5rem 2rem;
      max-width: 650px;
      margin: auto;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    button {
      background: #0077cc;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 0.6rem 1rem;
      cursor: pointer;
      font-size: 1rem;
      margin-top: 1rem;
    }
    button:hover { background: #005fa3; }
    pre {
      background: #f1f1f1;
      padding: 1rem;
      border-radius: 6px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Conversation Info</h2>
    <p><strong>Conversation ID:</strong> <span id="conversationId">Loading...</span></p>
    <p><strong>Status:</strong> <span id="statusText">Checking authentication...</span></p>
    <button id="fetchBtn" disabled>Fetch Conversation</button>
    <h3>API Response:</h3>
    <pre id="responseOutput">{}</pre>
  </div>

  <script>
    // --- CONFIG ---
    const CLIENT_ID = "277e7dba-0dc0-4066-9f5b-0db9f909ae5b"; // Replace with your Genesys OAuth client ID
    const REDIRECT_URI = "https://zayne-kerr.github.io/My-test/test.html";
    const AUTH_URL = "https://login.mypurecloud.ie/oauth/authorize";
    const SCOPES = "conversation:call:view conversation:call:edit";

    // --- GET CONVERSATION ID ---
    const urlParams = new URLSearchParams(window.location.search);
    const conversationId = urlParams.get("cid");
    document.getElementById("conversationId").textContent = conversationId || "Not found";

    const statusText = document.getElementById("statusText");
    const output = document.getElementById("responseOutput");
    const fetchBtn = document.getElementById("fetchBtn");

    // --- TOKEN MANAGEMENT ---
    function getTokenFromHash() {
      const hash = window.location.hash.substring(1);
      const params = new URLSearchParams(hash);
      return params.get("access_token");
    }

    function saveToken(token) {
      sessionStorage.setItem("gc_token", token);
    }

    function getToken() {
      return sessionStorage.getItem("gc_token");
    }

    let token = getTokenFromHash();
    if (token) {
      // Save token for next page loads
      saveToken(token);
      // Remove token from URL
      window.history.replaceState({}, document.title, window.location.pathname + window.location.search);
    }

    token = getToken();

    // --- AUTH CHECK ---
    if (!token) {
      statusText.textContent = "Redirecting to Genesys Cloud login...";
      const authUrl = `${AUTH_URL}?response_type=token&client_id=${encodeURIComponent(
        CLIENT_ID
